{# Cell index: If certain fields get left out, the counter shouldn't change. #}
{% set ci = 0 %}

{# Every time a cell shall be left out the STRG-jumping feature, $ci_offset has
   to be incremented ($ci_offset++) #}
{% set ci_offset = -1 %}

<td class="text-center">
    {# column name #}
    {% include 'columns_definitions/column_name.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'cfg_relation': cfg_relation,
        'max_rows': max_rows
    } only %}
    {% set ci = ci + 1 %}
</td>
<td class="text-center">
  <select class="column_type" name="field_type[{{ column_number }}]" id="field_{{ column_number }}_{{ ci - ci_offset }}"
    {{- column_meta['column_status'] is defined and not column_meta['column_status']['isEditable'] ? ' disabled' }}>
    {{ get_supported_datatypes(true, type_upper) }}
  </select>
  {% set ci = ci + 1 %}
</td>
<td class="text-center">
  <input id="field_{{ column_number }}_{{ ci - ci_offset }}" type="text" name="field_length[{{ column_number }}]" size="
    {{- length_values_input_size }}" value="{{ length }}" class="textfield">
  <p class="enum_notice" id="enum_notice_{{ column_number }}_{{ ci - ci_offset }}">
    <a href="#" class="open_enum_editor">{% trans 'Edit ENUM/SET values' %}</a>
  </p>
  {% set ci = ci + 1 %}
</td>
<td class="text-center">
  <select name="field_default_type[{{ column_number }}]" id="field_{{ column_number }}_{{ ci - ci_offset }}" class="default_type">
    <option value="NONE"{{ column_meta['DefaultType'] is defined and column_meta['DefaultType'] == 'NONE' ? ' selected' }}>
      {% trans %}None{% context %}for default{% endtrans %}
    </option>
    <option value="USER_DEFINED"{{ column_meta['DefaultType'] is defined and column_meta['DefaultType'] == 'USER_DEFINED' ? ' selected' }}>
      {% trans 'As defined:' %}
    </option>
    <option value="NULL"{{ column_meta['DefaultType'] is defined and column_meta['DefaultType'] == 'NULL' ? ' selected' }}>
      NULL
    </option>
    <option value="CURRENT_TIMESTAMP"{{ column_meta['DefaultType'] is defined and column_meta['DefaultType'] == 'CURRENT_TIMESTAMP' ? ' selected' }}>
      CURRENT_TIMESTAMP
    </option>
  </select>
  {% if char_editing == 'textarea' %}
    <textarea name="field_default_value[{{ column_number }}]" cols="15" class="textfield default_value">{{ default_value }}</textarea>
  {% else %}
    <input type="text" name="field_default_value[{{ column_number }}]" size="12" value="{{ default_value }}" class="textfield default_value">
  {% endif %}
  {% set ci = ci + 1 %}
</td>
<td class="text-center">
  {# column collation #}
  <select lang="en" dir="ltr" name="field_collation[{{ column_number }}]" id="field_{{ column_number }}_{{ ci - ci_offset }}">
    <option value=""></option>
    {% for charset in charsets %}
      <optgroup label="{{ charset.name }}" title="{{ charset.description }}">
        {% for collation in charset.collations %}
          <option value="{{ collation.name }}" title="{{ collation.description }}"
            {{- collation.name == column_meta['Collation'] ? ' selected' }}>
            {{- collation.name -}}
          </option>
        {% endfor %}
      </optgroup>
    {% endfor %}
  </select>
  {% set ci = ci + 1 %}
</td>
<td class="text-center">
    {# column attribute #}
    {% include 'columns_definitions/column_attribute.twig' with {
        'column_number': column_number,
        'ci': ci,
        'ci_offset': ci_offset,
        'column_meta': column_meta,
        'extracted_columnspec': extracted_columnspec,
        'submit_attribute': submit_attribute,
        'attribute_types': attribute_types
    } only %}
    {% set ci = ci + 1 %}
</td>
<td class="text-center">
    <input name="field_null[{{ column_number }}]" id="field_{{ column_number }}_{{ ci - ci_offset }}" type="checkbox" value="YES" class="allow_null"
      {{- column_meta['Null'] is not empty and column_meta['Null'] != 'NO' and column_meta['Null'] != 'NOT NULL' ? ' checked' }}>
    {% set ci = ci + 1 %}
</td>
{% if change_column is defined and change_column is not empty %}
    {# column Adjust privileges, Only for 'Edit' Column(s) #}
    <td class="text-center">
        {% include 'columns_definitions/column_adjust_privileges.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'privs_available': privs_available
        } only %}
        {% set ci = ci + 1 %}
    </td>
{% endif %}
{% if not is_backup %}
    {# column indexes, See my other comment about  this 'if'. #}
    <td class="text-center">
        {% include 'columns_definitions/column_indexes.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta
        } only %}
        {% set ci = ci + 1 %}
    </td>
{% endif %}
<td class="text-center">
  <input name="field_extra[{{ column_number }}]" id="field_{{ column_number }}_{{ ci - ci_offset }}" type="checkbox" value="AUTO_INCREMENT"
    {{- column_meta['Extra'] is defined and column_meta['Extra']|lower == 'auto_increment' ? ' checked' }}>
  {% set ci = ci + 1 %}
</td>
<td class="text-center">
  <textarea id="field_{{ column_number }}_{{ ci - ci_offset }}" rows="1" name="field_comments[{{ column_number }}]" maxlength="{{ max_length }}">
    {{- column_meta['Field'] is defined and comments_map is iterable and comments_map[column_meta['Field']] is defined ? comments_map[column_meta['Field']] -}}
  </textarea>
  {% set ci = ci + 1 %}
</td>
 {# column virtuality #}
{% if is_virtual_columns_supported %}
    <td class="text-center">
        {% include 'columns_definitions/column_virtuality.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'char_editing': char_editing,
            'expression': column_meta['Expression'] is defined ? column_meta['Expression'],
            'options': options
        } only %}
        {% set ci = ci + 1 %}
    </td>
{% endif %}
{# move column #}
{% if fields_meta is defined %}
    {% set current_index = 0 %}
    {% set cols = move_columns|length - 1 %}
    {% set break = false %}
    {% for mi in 0..cols %}
      {% if move_columns[mi].name == column_meta['Field'] and not break %}
        {% set current_index = mi %}
        {% set break = true %}
      {% endif %}
    {% endfor %}

    <td class="text-center">
        {% include 'columns_definitions/move_column.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'move_columns': move_columns,
            'current_index': current_index
        } only %}
        {% set ci = ci + 1 %}
    </td>
{% endif %}

{% if cfg_relation['mimework'] and browse_mime and cfg_relation['commwork'] %}
    <td class="text-center">
        {# Column Mime-type #}
        {% include 'columns_definitions/mime_type.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map
        } only %}
        {% set ci = ci + 1 %}
    </td>
    <td class="text-center">
        {# Column Browser transformation #}
        {% include 'columns_definitions/transformation.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map,
            'type': 'transformation'
        } only %}
        {% set ci = ci + 1 %}
    </td>
    <td class="text-center">
        {# column Transformation options #}
        {% include 'columns_definitions/transformation_option.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'mime_map': mime_map,
            'type_prefix': ''
        } only %}
        {% set ci = ci + 1 %}
    </td>
    <td class="text-center">
        {# Column Input transformation #}
        {% include 'columns_definitions/transformation.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'available_mime': available_mime,
            'mime_map': mime_map,
            'type': 'input_transformation'
        } only %}
        {% set ci = ci + 1 %}
    </td>
    <td class="text-center">
        {# column Input transformation options #}
        {% include 'columns_definitions/transformation_option.twig' with {
            'column_number': column_number,
            'ci': ci,
            'ci_offset': ci_offset,
            'column_meta': column_meta,
            'mime_map': mime_map,
            'type_prefix': 'input_'
        } only %}
        {% set ci = ci + 1 %}
    </td>
{% endif %}
